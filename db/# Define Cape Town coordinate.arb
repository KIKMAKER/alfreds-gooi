# Define Cape Town coordinate 

  CAPE_TOWN_LAT_MIN = -34.2
  CAPE_TOWN_LAT_MAX = -33.7
  CAPE_TOWN_LNG_MIN = 18.3
  CAPE_TOWN_LNG_MAX = 18.6

  puts '=' * 70
  puts 'CHECKING COORDINATE DATA'
  puts '=' * 70
  puts ''

  # Check all active subscriptions with coordinates
  all_with_coords = Subscription.active.where.not(latitude: nil, longitude: nil)
  puts "Total active subscriptions with coordinates: #{all_with_coords.count}"

  # Find invalid coordinates
  invalid_subs = all_with_coords.select { |s|  s.latitude < CAPE_TOWN_LAT_MIN || s.latitude > CAPE_TOWN_LAT_MAX ||  s.longitude < CAPE_TOWN_LNG_MIN || s.longitude > CAPE_TOWN_LNG_MAX  }

  puts "Subscriptions with INVALID coordinates (outside Cape Town): #{invalid_subs.count}"
  puts ''

  if invalid_subs.any?
    puts 'BREAKDOWN BY COLLECTION DAY:'
      %w[Monday Tuesday Wednesday Thursday].each do |day|
      count = invalid_subs.count {  |s| s.collection_day == day }
      total = all_with_coords.where(collection_day: day).count
      puts "  #{day}: #{count}  invalid out of #{total} total"
    end
    puts ''

    puts "SAMPLE OF INVALID COORDINATES (first 10):"
    invalid_subs.each do |sub|
      location = case
                 when sub.longitude > 140 then 'Australia'
                 when sub.longitude > 30 then 'Johannesburg area'
                 when sub.longitude < 0 then 'Americas'
                 when sub.latitude > -30 then 'Johannesburg/Pretoria area'
                 else 'Unknown'
                 end

      puts "  #{sub.user.first_name}  #{sub.user.last_name} (#{sub.suburb})"
      puts "    Address: #{sub.street_address}"
      puts "    Coords: (#{sub.latitude}, #{sub.longitude}) → #{location}"
      puts ''
    end
  end

  puts ''
  puts '=' * 70
  puts 'SUMMARY'
  puts '=' * 70
  valid_count = all_with_coords.count - invalid_subs.count
  puts "✓ Valid coordinates: #{valid_count}"
  puts "✗ Invalid coordinates: #{invalid_subs.count}"