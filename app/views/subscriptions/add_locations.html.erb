<div class="user-wrapper">
  <h1 class="my-4">Add Another Location</h1>

  <% if flash[:success] %>
    <div class="alert alert-success"><%= flash[:success] %></div>
  <% end %>

  <div class="user-form">
    <%= simple_form_for @subscription, url: create_locations_subscriptions_path, method: :post do |f| %>
      <%= f.error_notification %>

      <%#= f.input :street_address,
            placeholder: "e.g. 123 Main Road, Observatory",
            required: true %>
      <div data-controller="address-autocomplete" data-address-autocomplete-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>">
        <%= f.input :street_address, input_html: { data: { address_autocomplete_target: "address" },  class: "d-none"}, label_html: {class: "street-label"} %>
      </div>
      <%= f.input :suburb,
            as: :select,
            collection: Subscription::SUBURBS,
            prompt: "Select a suburb",
            required: true %>

      <%= f.input :apartment_unit_number,
            label: "Building name and unit number (if relevant)",
            placeholder: "e.g Unit 1 Garden View" %>

      <%= f.input :plan,
            label: "Choose a plan",
            collection: Subscription.plans.keys,
            label_method: lambda { |key|
              sym_key = (key == "XL" ? :XL : key.downcase.to_sym)
              Subscription.humanized_plans[sym_key] || key
            },
            required: true %>

      <%= f.input :duration,
            collection: [1, 3, 6, 12],
            label: "Duration (months)",
            required: true %>

      <div class="mt-3">
        <%= f.button :submit, "Add This Location", class: "small-yellow-btn" %>
      </div>
      <p class="text-muted mt-3">
        <small>You can add as many locations as you need. When you're done, click "Create Invoice" to proceed to payment.</small>
      </p>

      <div class="mb-4">
        <h3 class="my-3"><%= pluralize(@subscriptions.count, 'Location') %> Added</h3>
        <% if @subscriptions.any? %>
          <div class="mb-4">
            <% @subscriptions.each_with_index do |sub, index| %>
              <strong>Location <%= index + 1 %>:</strong>
              <%= sub.short_address %>, <%= sub.suburb %>
              <br>
              <small class="text-muted">
                Plan: <%= sub.plan %> | Duration: <%= sub.duration %> months | Collection Day: <%= sub.collection_day %>
              </small>
            <% end %>
          </div>
        <% end %>
      </div>
      <%= button_tag "Create Invoice",
              name: "commit",
              value: "Done - Create Invoice",
              class: "submit-btn" %>
    <% end %>
  </div>
</div>
