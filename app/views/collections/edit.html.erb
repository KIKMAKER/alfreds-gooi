<div class="collection-container user-wrapper">
  <div class="collection-body">
    <!--div containing back and whatsapp button-->
    <div class="collection-body-heading">
      <div class="back small-yellow-btn'">
        <%= link_to 'Back', today_subscriptions_path, class: 'small-yellow-btn' %>
      </div>
      <div class="whatsapp">
        <h1><strong><%= @subscription.user.first_name %></strong></h1>
        <%= link_to "https://wa.me/#{@subscription.user.phone_number}" do %>
          <i class="fa-brands fa-whatsapp" style="font-size: 30px"></i>
        <% end %>
      </div>
    </div>
    <!--div containing collection details-->
    <div class="collection-notes">

      <p>Issue bags:</p>
      <%= link_to issue_bags_collection_path(@collection) do %>
        <i class="fa-solid fa-sack-dollar" style="font-size: 32px"></i>
        <%#= image_tag 'empty_bucket.jpg', alt: "bucket", class:"bucket-img" %>
      <% end %>

      <strong>
        <p>Address:</p>
      </strong>
      <p><%= @subscription.street_address %></p>
      <% if @subscription.access_code %>
        <p>Access code: <%= @subscription.access_code %></p>
      <% end %>
      <% unless @collection.kiki_note_nil_zero? %>
        <strong>
          <p class = "collection-notes">Kiki's note:</p>
        </strong>
        <p><%= @collection.kiki_note %></p>
      <% end %>
      <% if @orders.any? %>
        <div class="outline p-3 mb-3">
          <strong>
            <p>Product Orders to Deliver:</p>
          </strong>
          <% @orders.each do |order| %>
            <% order.order_items.each do |item| %>
              <p><%= item.quantity %>x <%= item.product.title %></p>
            <% end %>
            <%= button_to "Mark Order ##{order.id} as Delivered",
                          mark_delivered_order_path(order),
                          method: :post,
                          class: "small-yellow-btn mt-2",
                          data: { turbo_confirm: "Confirm delivery of order ##{order.id}?" } %>
          <% end %>
        </div>
      <% end %>
    </div>

    <!--div containing forms-->
    <% if @collection.new_customer %>
      <%= simple_form_for [@collection] do |f| %>
        <%= f.input :skip %>
        <% if @collection.subscription.XL? %>
          <%= f.input :buckets, placeholder: "0" %>
        <% else %>
          <%= f.input :bags, label: "Number of bags collected", placeholder: "0" %>
        <% end %>
        <% if current_user.admin? %>
          <%= f.input :kiki_note, as: :text, label: "Message for Alfred" %>
          <%= f.input :date %>
          <p>Users subs:</p>
          <% @collection.subscription.user.subscriptions.each do |sub| %>
            <%= sub.id %>
          <% end %>
          <%= f.input :subscription_id %>
        <% end %>
        <hr>
        <%= f.input :alfred_message, as: :text, label: "Message for Kiki" %>
        <!-- Hidden field for start_time -->
        <%= f.hidden_field :time, value: Time.current %>
        <div class="text-center">
          <%= f.submit 'Dropped Off!', class: 'submit-btn' %>
        </div>
      <% end %>
    <% elsif @collection.subscription.user.drop_off? %>
      <%= simple_form_for [@collection] do |f| %>
        <%= f.input :skip %>
        <%= f.input :dropped_off_buckets, placeholder: "0" %>
        <% if current_user.admin? %>
          <%= f.input :kiki_note, as: :text, label: "Message for Alfred" %>
          <%= f.input :date %>
          <p>Users subs:</p>
          <% @collection.subscription.user.subscriptions.each do |sub| %>
            <%= sub.id %>
          <% end %>
          <%= f.input :subscription_id %>
        <% end %>
        <hr>
        <%= f.input :alfred_message, as: :text, label: "Message for Kiki" %>
        <!-- Hidden field for start_time -->
        <%= f.hidden_field :time, value: Time.current %>
        <div class="text-center">
          <%= f.submit 'Done!', class: 'submit-btn' %>
        </div>
      <% end %>
    <% else %>
      <%= simple_form_for [@collection] do |f| %>
        <%= f.input :skip %>
        <% if @subscription.Standard? %>
          <%= f.input :bags, label: "Number of bags collected", placeholder: "0" %>
        <% elsif @subscription.XL? %>
          <%= f.input :buckets, label: "Number of buckets collected", placeholder: "0" %>
        <% end %>
        <% if current_user.admin? %>
          <%= f.input :kiki_note, as: :text, label: "Message for Alfred" %>
          <%= f.input :date %>
          <p>Users subs:</p>
          <% @collection.subscription.user.subscriptions.each do |sub| %>
            <%= sub.id %>
          <% end %>
          <%= f.input :subscription_id %>
        <% end %>
        <hr>
        <%= f.input :alfred_message, as: :text, label: "Message for Kiki" %>
        <!-- Hidden field for start_time -->
        <%= f.hidden_field :time, value: Time.current %>
        <div class="centre">
          <%= f.submit 'Done!', class: 'small-yellow-btn' %>
        </div>
      <% end %>
    <% end %>
  </div>

</div>
