<div class="driver-wrapper">
  <%= link_to 'all drivers days', drivers_days_path, class:"link-title mb-3" %>
  <%= link_to 'logistics dashboard', admin_logistics_path, class:"link-title mb-3" %>
  <h2>Daily list</h2>
  <%= link_to 'todays list', today_subscriptions_path, class: 'small-yellow-btn mt-3' %>
  <%= form_with url: route_drivers_days_path, method: :get, local: true do |f| %>
    <div class="d-flex align-items-center my-3">
      <div>
        <%= date_field_tag :date, Date.today, class: "form-control" %>
      </div>
      <div>
        <%= submit_tag "View list", class: "small-yellow-btn" %>
      </div>
    </div>
  <% end %>
  <br>
  <h2>Skips for <%= @day %>:</h2>
  <div class="skip-collections">
    <div class="skipped p-4">
      <h3>Already skipped</h3>
      <% @skipped_collections.each do |collection| %>
        <p class="mb-3"><%=  collection.subscription.user.first_name%></p>
      <% end %>
    </div>
    <div class="skip-form p-4">
      <h3>Select to skip</h3>
      <%= simple_form_for(:skip_today_collections, url: skip_today_collections_path, method: :patch) do |f| %>
        <% @unskipped_collections.each do |collection| %>
          <%= f.input collection.id, label: collection.subscription.user.first_name, as: :boolean %>
        <% end %>
        <%= f.submit "Update all", class: "small-yellow-btn" %>
      <% end %>
    </div>
  </div>
  <h2>Create Collections</h2>
  <%= button_to 'Create for Next Week', perform_create_next_week_collections_path, class: 'small-yellow-btn', data: { confirm: 'Are you sure you want to run this job?' } %>
  <div class="d-flex mt-3">
    <%= button_to 'Create for Today', perform_create_today_collections_path, class: 'small-yellow-btn', data: { confirm: 'Are you sure you want to run this job?' } %>
  </div>
  <br>
  <p><%= @unskipped_collections.count + @skipped_collections.count %> collections created for today</p>
  <br>

  <h2>Optimize Routes</h2>
  <p class="text-muted">Uses RouteXL API to optimize collection order. Costs EUR 5 per route.</p>
  <div class="d-flex flex-wrap gap-2 mt-3">
    <%= button_to 'Sort Monday Route', optimise_route_with_routexl_path(day: 'Monday'),
        class: 'btn btn-danger',
        style: 'border-radius:1em',
        data: { confirm: "This costs EUR 5. Optimize #{Subscription.active.where(collection_day: 'Monday').count} Monday subscriptions?" } %>
    <%= button_to 'Sort Tuesday Route', optimise_route_with_routexl_path(day: 'Tuesday'),
        class: 'btn btn-primary',
        style: 'border-radius:1em',
        data: { confirm: "This costs EUR 5. Optimize #{Subscription.active.where(collection_day: 'Tuesday').count} Tuesday subscriptions?" } %>
    <%= button_to 'Sort Wednesday Route', optimise_route_with_routexl_path(day: 'Wednesday'),
        class: 'btn btn-success',
        style: 'border-radius:1em',
        data: { confirm: "This costs EUR 5. Optimize #{Subscription.active.where(collection_day: 'Wednesday').count} Wednesday subscriptions?" } %>
    <%= button_to 'Sort Thursday Route', optimise_route_with_routexl_path(day: 'Thursday'),
        class: 'btn btn-warning',
        style: 'border-radius:1em',
        data: { confirm: "This costs EUR 5. Optimize #{Subscription.active.where(collection_day: 'Thursday').count} Thursday subscriptions?" } %>
  </div>
  <br>
</div>
