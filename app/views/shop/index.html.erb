<div class="driver-wrapper">
  <h1 class="my-4">Shop</h1>
  <p class="mb-4">Order products to be delivered with your next collection</p>

  <% if @products.any? %>
    <div class="collections">
      <% @products.each do |product| %>
        <div class="outline mb-3 p-3">
          <% if product.primary_image %>
            <%= image_tag product.primary_image, class: "img-fluid rounded mb-3", style: "max-height: 300px; width: 100%; object-fit: cover;" %>
          <% end %>
          <h3><%= product.title %></h3>
          <p class="text-muted"><%= product.description %></p>
          <p class="text-success"><strong>R<%= product.price.to_i %></strong></p>

          <% if product.in_stock? %>
            <p class="text-muted"><small><%= product.stock %> in stock</small></p>
            <div class="form-row">
              <%= form_with url: add_to_order_path, method: :post, local: true do |f| %>
                <%= f.hidden_field :product_id, value: product.id %>
                <div class="d-flex align-items-center gap-3">
                  <%= f.number_field :quantity, value: 1, min: 1, max: product.stock, class: "form-control w-auto text-center" %>
                  <%= f.submit "Add", class: "small-yellow-btn" %>
                </div>
              <% end %>
            </div>
          <% else %>
            <p class="text-danger"><strong>Out of Stock</strong></p>
          <% end %>
        </div>
      <% end %>
    </div>
  <% else %>
    <div class="outline my-5">
      <p>No products available at the moment. Check back soon!</p>
    </div>
  <% end %>

  <% if @current_order.order_items.any? %>
    <div class="mt-5">
      <h2>Your Order</h2>
      <div class="collections">
        <% @current_order.order_items.each do |item| %>
          <div class="collection mb-2">
            <div class="name">
              <p><%= item.product.title %></p>
            </div>
            <div class="bag">
              <p><%= item.quantity %> x R<%= item.price.to_i %></p>
            </div>
            <div class="address">
              <%= button_to "Remove", remove_from_order_path(item), method: :delete, class: "btn btn-sm btn-outline-danger" %>
            </div>
          </div>
        <% end %>
      </div>

      <div class="mt-3">
        <p><strong>Total: R<%= @current_order.total_amount.to_i %></strong></p>
        <%= link_to "Checkout", checkout_order_path(@current_order), class: "submit-btn" %>
      </div>
    </div>
  <% end %>
</div>
