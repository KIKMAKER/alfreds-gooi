<div class="driver-wrapper">
  <h1 class="my-4">My Subscriptions</h1>
  <%= link_to "← Back to Dashboard", manage_path, class: "d-block mb-3" %>

  <% if @subscriptions.any? %>
    <div class="collection-header">
      <div>
        <p>Plan</p>
      </div>
      <div class="">
        <p>Duration</p>
      </div>
      <div class="">
        <p>Dates</p>
      </div>
      <div class="">
        <p>Bags collected</p>
      </div>
      <div class="">
        <p>Invoices</p>
      </div>
    </div>

    <div class="collections">
      <% @subscriptions.each do |subscription| %>
        <div class="collection">
          <div class="d-flex flex-column">
            <p><strong><%= subscription.plan %></strong></p>
            <p class="small"><%= subscription.status.titleize %></p>
          </div>
          <div class="d-flex flex-column">
            <p><%= subscription.duration %> month<%= subscription.duration > 1 ? 's' : '' %></p>
            <p class="small"><%= subscription.total_collections %> collections</p>
          </div>
          <div class="">
            <p><%= subscription.start_date ? subscription.start_date.strftime("%d %b %Y") : "TBD" %> - <%= subscription.end_date ? subscription.end_date.strftime("%d %b %Y") : "TBD" %></p>
          </div>
            <p class="small"><%= subscription.total_bags %></p>
        <% if subscription.invoices.any? %>
          <div class="">
            <div class="d-flex flex-column">
              <% subscription.invoices.order(issued_date: :desc).each do |invoice| %>
                <%= link_to "Invoice ##{invoice.id} (R#{invoice.total_amount.to_i})",
                            invoice_path(invoice),
                            class: "link-text" %>
              <% end %>
            </div>
          </div>
        <% end %>
      <% end %>
        </div>

    </div>
  <% else %>
    <div class="outline my-5">
      <p class="text-center">You don't have any subscriptions yet</p>
    </div>
  <% end %>
</div>
